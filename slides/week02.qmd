---
title: "Version control and reproducible research"
subtitle: "BIOSTAT620: Introduction to Health Data Science"
author: "Dylan Cable"
format:
  revealjs:
    theme: default
    fig-width: 7
    fig-align: center
---

```{r, include=FALSE}
library(knitr)
opts_chunk$set(
  echo = TRUE)
```

# Part I: Intro and unix

---


## Naming convention

* In general you want to name your files in a way that is related to their contents and specifies how they relate to other files. 

* The [Smithsonian Data Management Best Practices](https://library.si.edu/sites/default/files/tutorial/pdf/filenamingorganizing20180227.pdf) has "five precepts of file naming and organization"

--- 

## Five precepts of file naming and organization

* Have a distinctive, human-readable name that gives an indication of the content.
* Follow a consistent pattern that is machine-friendly.
* Organize files into directories (when necessary) that follow a consistent pattern.
* Avoid repetition of semantic elements among file and directory names.
* Have a file extension that matches the file format (no changing extensions!)

For specific recommendations we highly recommend you follow The [Tidyverse Style Guide](https://style.tidyverse.org/)

--- 

## The terminal

- Instead of clicking, dragging, and dropping to organize our files and folders, we will be typing Unix commands into the terminal. 

- The way we do this is similar to how we type commands into the R console, but instead of generating plots and statistical summaries, we will be organizing files on our system.

---

## The terminal

- The terminal is integrated into Mac and Linux systems, but Windows users will have to install an emulator. Once you have a terminal open, you can start typing commands. 

- You should see a blinking cursor at the spot where what you type will show up. This position is called the command line. 

---

## The filesystem 


![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img//unix/filesystem.png)

---

## The home directory


![](img/homedir.png) 

--- 

## Windows

The structure on Windows looks something like this:

![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img//unix/windows-filesystem-from-root.png)

---
 
## Mac
 
 And on MacOS something like this:

![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img//unix/mac-filesystem-from-root.png)

---

## Working directory

- The working directory is the directory you are currently *in*. Later we will see that we can move to other directories using the command line.
- It's similar to clicking on folders.

- You can see your working directory using the Unix command `pwd`

In R we can use `getwd()`


---

## Paths 

- This string returned in previous command is *full path* to working directory.

- The full path to your home directory is stored in an *environment* variable. 

- You can see it like this `echo $HOME`


---

## Paths

- In Unix, we use the shorthand `~` as a nickname for your home directory

- Example: the full path for *docs* (in image above) can be written like this `~/docs`.

- Most terminals will show the path to your working directory right on the command line. 

- Try opening a terminal window and see if the working directory is listed.

---

## Unix commands

- `ls`: Listing directory content

- `mkdir` and `rmdir`: make and remove a directory

- `cd`: navigating the filesystem by changing directories

- `pwd`: see your workding directory

- `mv`: moving files

- `cp`: copying files

- `rm`: removing files

- `less`: looking at a file

---

## Autocomplete

- In Unix you can auto-complete by hitting tab. 

- This means that we can type `cd d` then hit tab. 

- Unix will either auto-complete if `docs` is the only directory/file starting with `d` or show you the options. 

- Try it out! Using Unix without auto-complete would make it unbearable.



## Text editors

Command-line text editors are essential tools, especially for system administrators, developers, and other users who frequently work in a terminal environment. Here are some of the most popular command-line text editors:

* Nano 
* Pico 
* Vi or Vim 
* Emacs 


## Other very useful commands you should learn


* curl - download data from the internet.

* tar - archive files and subdirectories of a directory into one file.

* ssh - connect to another computer.

* find - search for files by filename in your system.

* grep - search for patterns in a file.

* awk/sed - These are two very powerful commands that permit you to find specific strings in files and change them.


---

## Resources

To get started.

-   <https://www.codecademy.com/learn/learn-the-command-line>
-   <https://www.edx.org/course/introduction-linux-linuxfoundationx-lfs101x-1>
-   <https://www.coursera.org/learn/unix>

---

# Part 2: Version control

---

## What is version control? {.smaller}

:::: .columns
::: {.column width=29%}
![](https://upload.wikimedia.org/wikipedia/commons/a/af/Revision_controlled_project_visualization-2010-24-02.svg)
:::
::: {.column width=70%} 
[I]s the **management of changes** to documents [...] **Changes are usually identified** by a number or letter code, termed the "revision number", "revision level", or simply "revision". For example, an initial set of files is "revision 1". When the first change is made, the resulting set is "revision 2", and so on. **Each revision is associated with a timestamp and the person making the change**. Revisions can be **compared**, **restored**, and with some types of files, **merged**. -- [Wikipedia](https://en.wikipedia.org/w/index.php?title=Version_control&oldid=948839536)
:::
::::





---

## Motivation

We want to avoid this:

![Posted by rjkb041 on r/ProgrammerHumor](https://preview.redd.it/02o1a7v23qf71.jpg?auto=webp&s=bb61f40a88e2940e4f4b20a56640fcf12a7b1a39)

----

## Motivation

* This is particularly true when more than one person is collaborating and editing the file. 

* Even more important when there are multiple files, as there is in software development, and to some extend data analysis.

----

## Motivation 

* Git is a version control system that provides a systematic approach to keeping versions of files. 

![Posted on devrant.com/ by bhimanshukalra](https://img.devrant.com/devrant/rant/r_1840117_3JUPn.jpg)

----

## Motivation

But we have to learn some things.

![From Meme Git Compilation by Lulu Ilmaknun Qurotaini](https://miro.medium.com/v2/resize:fit:1200/format:webp/0*VcMPr1unIjAIHw2j.jpg)

----

:::{.callout-note}
In these notes, I use `< >` to denote a placeholder. So if I say `<filename>` what you eventually type is the filename you want to use, without the `< >`
:::

----

## Why do we care {.smaller}

Have you ever:

- Made a **change to code**, realised it was a **mistake** and wanted to **revert** back?

- **Lost code** or had a backup that was too old?

- Had to **maintain multiple versions** of a product?

- Wanted to see the **difference between** two (or more) **versions** of your code?

- Wanted to prove that a particular **change broke or fixed** a piece of code?

- Wanted to **review the history** of some code?

---

## Why do we care (cont'd) {.smaller}

- Wanted to submit a **change** to **someone else's code**?

- Wanted to **share your code**, or let other people work on your code?

- Wanted to see **how much work** is being done, and where, when and by whom?

- Wanted to **experiment** with a new feature **without interfering** with working code?

In these cases, and no doubt others, a version control system should make your life easier.

-- [Stackoverflow](https://stackoverflow.com/a/1408464/2097171) (by [si618](https://stackoverflow.com/users/44540/si618))

---

## Git: The stupid content tracker

<div style="text-align: center;">
  <figure>
  <a href="https://commons.wikimedia.org/wiki/File:Git-logo.svg" target="_blank"><img style="width: 200px;vertical-align: middle;" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Git-logo.svg/500px-Git-logo.svg.png" hspace="20px" alt="Git logo"></a>
  <a href="https://en.wikipedia.org/wiki/Linus_Torvalds" target="_blank"><img style="width: 200px;vertical-align: middle;"  hspace="20px" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/LinuxCon_Europe_Linus_Torvalds_03_%28cropped%29.jpg/345px-LinuxCon_Europe_Linus_Torvalds_03_%28cropped%29.jpg" alt="Linus Torvalds"></a>
  </figure>
  <figcaption><b>Git logo and Linus Torvalds, creator of git</b></figcaption>
</div>

---

## Git: The stupid content tracker

- During this class (and perhaps, the entire program) we will be using [Git](https://git-scm.com).

- Git is used by [most developers in the world](https://insights.stackoverflow.com/survey/2018#work-_-version-control).

- A great reference about the tool can be found [here](https://git-scm.com/book)

- More on what's stupid about git [here](https://en.wikipedia.org/wiki/Git#Naming).

---

## How can I use Git

There are several ways to include Git in your work-pipeline. A few are:

- Through command line

- Through one of the available Git GUIs:

  - RStudio [(link)](https://rstudio.com/products/rstudio/features/)
  
  - Git-Cola [(link)](https://git-cola.github.io/)
  
  - **Github Desktop** [(Link)](https://desktop.github.com/)

More alternatives [here](https://git-scm.com/download/gui).

---

## Goal for the day

Learn how to:

* Create a repository
* push something to the repository
* connect RStudio to GitHub

----


## Do you have git?

Before we start: 

* Make sure you have Git installed. 
* Open a terminal and type:

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git --version
```

If not installed 

* on a Mac, follow the instructions after typing the above.
* on Windows follow [these instructions](https://gitforwindows.org/)


----

## What is Git?


![](https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/68739659-fb6f-41e8-9813-32e1de3d82c0_rw_3840.png?h=5c36d3c50c350a440567a1f8f72ac028)


----

## What is GitHub?

* Described a _social network for software developers_. 

* Basically, it's a service that hosts the _remote repository (repo)_ on the web. 

* This facilitates collaboration and sharing greatly. 

----

## What is GitHub?

There many other features such as 

* Recognition system: reward, badges and stars.
* You can host web pages, like the class notes for example.
* Permits contributions via _forks_ and _pull requests_.
* Issue tracking 
* Automation tools. 

----

## What is GitHub?


* The main tool behind GitHub is Git.

* Similar to how the main tool behind RStudio is R.

----

## GitHub accounts

* Pick a professional sounding name.

* Consider adding a profile `README.md`. 

* Instructions are [here](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-profile/customizing-your-profile/managing-your-profile-readme).

* Example [here](https://github.com/rafalab).


----


## Repositories

* A GitHub repository (repo) is where your store your code for a project. 

* You will have at least two copies of your code: one on your computer and one on GitHub.

* If you add collaborators to this repo, then each will have a copy on their computer. 

* The GitHub copy is considered the main (previously called master) copy that everybody syncs to. 

* Git will help you keep all the different copies synced.

----

---

## Overview of Git

The main actions in Git are to: 

1. **pull** changes from the remote repo.
2. **add** files, or as we say in the Git lingo _stage_ files.
3. **commit** changes to the local repo.
4. **push** changes to the _remote_ repo.

----

![From Meme Git Compilation by Lulu Ilmaknun Qurotaini](https://miro.medium.com/v2/resize:fit:880/format:webp/0*cesFJY5JFpI0Rl4v.jpg)

----

## The four areas of Git


![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-layout.png)

----

## Status

![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-status.png)
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git status filename
```

----

## Add 

Use `git add` to put file to staging area.

![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-add.png)

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git add <filename>
```

We say that this file has been _staged_. Check to see what happened:


```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git status <filename>
```


----

## Commit

* To move all the staged files to the local repository we use `git commit`.



![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-commit.png)



```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git commit -m "must add comment"
``` 

* Once _committed_ the files are _tracked_ and a copy of this version is kept going forward.



* This is like adding `V1` to your filename.


----

## Commit

:::{.callout-note}
You can commit files directly without using `add` by explicitely writing the files at the end of the commit:
:::

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git commit -m "must add comment" <filename>
``` 

----

## Push

* To move to upstream repo we use `git push`

![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-push.png)

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git push -u origin main
```

* The `-u` flag sets the upstream repo.

* By using this flag, going forward you can simply use `git push` to push changes. 

* So going forward we can just type:

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git push
```

----

## Push

* When using `git push` we need to be careful as if collaborating this will affect the work of others. 

* It might also create a `conflict`.

![Posted by andortang on Nothing is Impossible!](https://andortang.wordpress.com/wp-content/uploads/2017/05/winter-is-coming-brace-yourself-merge-conflicts-are-coming.jpg)


----

## Fetch

* To update our local remote-tracking branch to match the remote repository.

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git fetch
```

![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-fetch.png)

----

## Merge

* Once we are sure this is good, we can merge with our local files:

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git merge
```

![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-merge.png)

----

## Pull

:::{::callout-note}
I rarely use `fetch` and `merge` and instead use `pull` which does both of these in one step
:::

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git pull
```


![](http://rafalab.dfci.harvard.edu/dsbook-part-1/productivity/img/git/git-pull.png)



----

## Checkout

* If you want to pull down a specific file you from the remote repo you can use:

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git checkout filename
```

* I use this when I make changes but decide I want to go back to original version on remote repo.

:::{.callout-warning}
If you have a newer version in your local repository this will create a **_conflict_**. It won't let you do it. If you are sure you want to get rid of your local copy you can remove it and then use `checkout`.
:::

----

## Checkout

* You can also use `checkout` to obtain older version:

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git checkout <commit-id> <filename>
```

* You can get the `commit-id` either on the GitHub webpage or using

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git log filename
```

----

## Reset

* What if I commit and realize it was a mistake?

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git reset HEAD~1
```

undos the commit and unstages the files, but **keeps your local copies**. I use this on very often.

* There are many wasy of using `get reset` and it covers most scenarios. 
 
* ChatGPT and stackoverflow are great resources to learn more.

----
  

## Branches

* We are just sratching the surface of Git.

* One advanced feature to be aware of is that you can have several _branches_, useful for working in parallel or testing stuff out that might not make the main repo. 

![Art by: Allison Horst](https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/efae32ce-863f-4773-852c-4335e3ce4709_rw_3840.png?h=c54a2e5af240ec6e1332e2dcacbd7f33)


----

## Branches

* We wont go over this, but we might need to use these two related commands:

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git remote -v
git branch 
```

----

## Clone


* Another common command is `git clone`.

* It let's download an entire repo, including version history.

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: false

git clone <repo-url>
```


----

## Using Git in RStudio

* Go to file, new project, version control, and follow the instructions. 

* Then notice the `Git` tab in the preferences.

---

 
## Basic commands

![](img/gitbasic.png)

## A Common workflow {.smaller}

1. Start the session by pulling (possible) updates: `git pull`
2. Make changes to your files
    a. (optional) Revert changes on a file: `git restore [target file]`
3. Move changes to the staging area: `git add`
    a. (optional) Add untracked (possibly new) files: `git add [target file]`
    b. (optional) Stage tracked files that were modified: `git add -u`
4. Commit:
    a. If finished staging: `git commit -m "Your comments go here."`
    b. If modifications not staged: `git commit -a -m "Your comments go here."`
5. Upload the commit to the remote repo: `git push`.


## First time

![](img/git_first.png)

## The rest of the time

![](img/git_rest.png)
---

## Check the status

* Can't remember if you've changed any files? 
* Don't know if your local repository is in sync with the remote repository?

You can always check the current state of your repository with `git status`!

---

# Resources {.smaller}

- Git's everyday commands, type `man giteveryday` in your terminal/command line.
  and the very nice [cheatsheet](https://github.github.com/training-kit/).

- My personal choice for nightstand book: The Pro-git book (free online) [(link)](https://git-scm.com/book)

- Github's website of resources [(link)](https://try.github.io/)

- The "Happy Git with R" book [(link)](https://happygitwithr.com/)

- Roger Peng's Mastering Software Development Book Section 3.9 Version control and Github [(link)](https://bookdown.org/rdpeng/RProgDA/version-control-and-github.html)

---

- Git exercises by Wojciech FrÄ…cz and Jacek Dajda [(link)](https://gitexercises.fracz.com/)

- Checkout GitHub's Training YouTube Channel [(link)](https://www.youtube.com/user/GitHubGuides)


![From Meme Git Compilation by Lulu Ilmaknun Qurotaini](https://miro.medium.com/v2/resize:fit:820/format:webp/0*Gb3B1-Xk5qHaxU7v.jpg)

For more memes see [Meme Git Compilation by Lulu Ilmaknun](https://medium.com/@lulu.ilmaknun.q/kompilasi-meme-git-e2fe49c6e33e)
